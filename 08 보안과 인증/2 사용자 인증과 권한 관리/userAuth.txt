사용자 인증과 권한 관리
웹 애플리케이션에서 사용자의 신원을 확인하고, 특정 기능이나 리소스에 접근할 수 있는 권한을 부여하는 중요한 주제

사용자 인증(Authentication)
- 사용자의 신원을 확인하는 과정으로, 로그인을 통해 신원을 검증
- 주요한 사용자 인증 방법으로는 아이디와 비밀번호를 사용한 인증, 소셜 로그인(OAuth)
- Node.js에서는 패스워드 해싱(bcrypt, argon2 등)과 같은 암호화 기법을 사용하여 비밀번호를 안전하게 저장
- 사용자 인증을 위해 passport와 같은 인증 미들웨어를 사용할 수 있습니다.

권한 관리(Authorization)
- 인증된 사용자에게 특정 기능이나 리소스에 접근할 수 있는 권한을 부여하는 과정
- 주요한 권한 관리 방법으로는 역할 기반 권한 관리(RBAC)와 사용자 기반 권한 관리
- 권한 관리를 위해 roles와 같은 역할과 권한을 관리하는 데이터베이스 테이블을 사용
- 권한 관리를 적용하기 위해 미들웨어를 사용하여 요청 전에 권한을 검사

Node.js에서 사용자 인증과 권한 관리를 구현하기 위해 다양한 패키지와 미들웨어를 활용
주로 passport, bcrypt, jsonwebtoken 등의 패키지를 사용하여 사용자 인증과 권한 관리를 구현
웹 애플리케이션의 보안을 강화하고, 인증된 사용자만이 허가된 기능과 리소스에 접근

Node.js에서 주로 사용되는 패키지인 passport, bcrypt와 함께 JSON Web Token(JWT)을 활용한 예제 코드

const express = require('express');
const passport = require('passport');
const bcrypt = require('bcrypt');
const jwt = require('jsonwebtoken');

const app = express();

// 사용자 데이터베이스 예시
const users = [
  { id: 1, username: 'user1', password: '$2b$10$2H9vU0w8c0wQz1VQaZ7lgeRv3v9s2lDlqjhrK3m3cJ8JXzN8VlW9S' } // 패스워드: password1
];

// passport 설정
passport.use(new LocalStrategy((username, password, done) => {
  const user = users.find(u => u.username === username);
  if (!user) {
    return done(null, false);
  }
  bcrypt.compare(password, user.password, (err, isMatch) => {
    if (err) {
      return done(err);
    }
    if (isMatch) {
      return done(null, user);
    } else {
      return done(null, false);
    }
  });
}));

// 로그인 라우트
app.post('/login', (req, res, next) => {
  passport.authenticate('local', { session: false }, (err, user, info) => {
    if (err || !user) {
      return res.status(401).json({ message: '인증 실패' });
    }
    req.login(user, { session: false }, (err) => {
      if (err) {
        return res.status(500).json({ message: '서버 오류' });
      }
      const token = jwt.sign({ id: user.id, username: user.username }, 'mysecretkey');
      return res.json({ token });
    });
  })(req, res, next);
});

// 보호된 라우트
app.get('/protected', passport.authenticate('jwt', { session: false }), (req, res) => {
  res.json({ message: '인증된 사용자만 접근 가능한 페이지' });
});

app.listen(3000, () => {
  console.log('서버가 정상적으로 시작되었습니다.');
});

로그인 기능을 구현하고, JWT를 사용하여 인증된 사용자만 접근 가능한 보호된 라우트를 설정하는 예제
passport를 사용하여 사용자 인증을 처리
패스워드는 bcrypt를 사용하여 안전하게 해싱
로그인 요청은 /login 경로로 POST 요청을 보내며, 인증에 성공하면 JWT 토큰을 발급
보호된 라우트(/protected)는 passport.authenticate를 사용하여 JWT를 검사하고, 인증되지 않은 경우 401 Unauthorized 응답을 반환

/login으로 POST 요청을 보내면 인증에 성공하면 JWT 토큰이 반환
토큰을 사용하여 /protected로 GET 요청을 보내면 인증된 사용자만 접근할 수 있는 페이지에 접근